from typing import Dict, List, Tuple, Callable
from copy import deepcopy
import more_itertools as mitt
from math import floor, log
from itertools import zip_longest


# Borrowed from Barto and Suttons original implementation at: http://incompleteideas.net/tiles/tiles3.py-remove
basehash = hash
class IHT:
    "Structure to handle collisions"
    def __init__(self, size_val):
        self.size = size_val
        self.overfull_count = 0
        self.dictionary = {}

    def count(self):
        return len(self.dictionary)

    def full(self):
        return len(self.dictionary) >= self.size

    def get_index(self, obj, read_only=False):
        d = self.dictionary
        if obj in d:
            return d[obj]
        elif read_only:
            return None
        size = self.size
        count = self.count()
        if count >= size:
            if self.overfull_count == 0: print('IHT full, starting to allow collisions')
            self.overfull_count += 1
            return hash(obj) % self.size
        else:
            d[obj] = count
            return count